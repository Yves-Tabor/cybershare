<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberShare | Secure Networking</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&family=Orbitron:wght@500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-deep: #0a0b0d;
            --card-bg: #14161a;
            --primary: #4A9EFF;
            --text-main: #e1e1e1;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            --error: #ff4a4a;
            --success: #4aff9e;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg-deep);
            color: var(--text-main);
            line-height: 1.5;
            overflow-x: hidden;
        }

        .grid-overlay {
            position: fixed;
            inset: 0;
            background-image: radial-gradient(circle at 2px 2px, rgba(255,255,255,0.02) 1px, transparent 0);
            background-size: 40px 40px;
            z-index: -1;
        }

        header {
            position: fixed;
            top: 0; width: 100%;
            height: 85px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 8%;
            background: rgba(10, 11, 13, 0.8);
            backdrop-filter: blur(8px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
        }

        .logo {
            font-family: 'cambria', sans-serif;
            font-size: 1.3rem;
            letter-spacing: 3px;
            font-weight: 900;
        }

        .logo span { color: var(--primary); }

        .btn {
            padding: 8px 20px;
            font-size: 0.85rem;
            border-radius: 5px;
            cursor: pointer;
            transition: 0.2s;
            font-family: 'Inter', sans-serif;
            font-weight: 600;
        }
        .btn:hover{
          transform: scale(1.05);
          border-color: var(--primary);
        }

        .btn-login { background: transparent; color: var(--text-main); border: 1px solid var(--border); margin-right: 10px; }
        .btn-signup { background: var(--primary); color: #000; border: none; }
        .btn-signup:hover { opacity: 0.9; }

        .hero {
            height: 80vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 0 10%;
        }

        .hero h1 {
            font-family: 'Cambria', sans-serif;
            font-size: 5rem;
            margin-bottom: 1rem;
            color: #fff;

        }

        .tagline {
            color: var(--text-dim);
            font-size: 1rem;
            max-width: 500px;
            letter-spacing: 1px;
        }

        .features { padding: 4rem 10%; }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .feature-card {
            background: var(--card-bg);
            border: 1px solid var(--border);
            padding: 2rem;
            border-radius: 12px;
            transition: border 0.3s ease;
        }

        .feature-card:hover { 
          border-color: var(--primary);
          transform: scale(1.06);
          transition: transform 0.3s ease;
        }
        .feature-card h3 { color: var(--primary); font-size: 1rem; margin-bottom: 10px; text-transform: uppercase; }
        .feature-card p { font-size: 0.9rem; color: var(--text-dim); }

        .modal-overlay {
            position: fixed; inset: 0;
            background: rgba(0,0,0,0.8);
            display: none; justify-content: center; align-items: center;
            z-index: 2000;
        }

        .modal {
            background: rgba(10, 11, 13, 0.8);
            padding: 2.5rem;
            border-radius: 16px;
            width: 100%; max-width: 380px;
            border: 2px solid white;
        }

        .modal input {
            width: 100%; padding: 12px;
            margin-bottom: 1rem;
            background: #0d0e12;
            border: 1px solid var(--border);
            color: white; border-radius: 6px;
        }

        .modal input:focus { outline: 1px solid var(--primary); }
        
        /* Message Paragraph Style */
        .auth-msg {
            margin-top: 1rem;
            font-size: 0.8rem;
            font-weight: 500;
            text-align: center;
            min-height: 1.2rem;
        }
        .msg-error { color: white; }
        .msg-success { color: var(--success); }

        .modal-active { display: flex; }
        
        /* Unverified User Styling */
        .unverified-user {
            background: rgba(0, 0, 0, 0.5) !important;
            border: 1px solid rgba(92, 92, 92, 0.738) !important;
        }
        
        .unverified-badge {
            background: rgba(10, 11, 13, 0.8);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .verification-warning {
            background: rgba(10, 11, 13, 0.8);
            color: white;
            padding: 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            margin-top: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="grid-overlay"></div>

    <header>
        <div class="logo">CYBER<span>SHARE</span></div>
        <div class="auth-buttons">
            <button class="btn btn-login" onclick="toggleModal('loginModal')">Login</button>
            <button class="btn btn-signup" onclick="toggleModal('signupModal')">Join</button>
        </div>
    </header>

    <section class="hero">
        <h1>Connect.</h1>
        <p class="tagline">"Secure your websites. Share your knowledge."</p>
    </section>

    <section class="features">
        <div class="features-grid">
            <div class="feature-card">
                <h3>Encryption</h3>
                <p>Protecting your website doesn't have to be complicated. Stay ahead of threats.</p>
            </div>
            <div class="feature-card">
                <h3>Resources</h3>
                <p>Share knowledge, links, and meeting reports within a secure environment.</p>
            </div>
            <div class="feature-card">
                <h3>Community</h3>
                <p>A world where websites are secured and the community is connected.</p>
            </div>
        </div>
    </section>

    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <h2 style="margin-bottom: 1.5rem">Login</h2>
            <form id="loginForm">
                <input type="email" id="loginEmail" placeholder="Email" required>
                <input type="password" id="loginPassword" placeholder="Password" required>
                <button type="submit" class="btn btn-signup" style="width: 100%">Enter System</button>
                <p id="loginMsg" class="auth-msg"></p>
                <div style="text-align: center; margin-top: 1rem;">
                    <a href="#" onclick="openForgotPassword()" style="color: var(--primary); font-size: 0.85rem; text-decoration: none;">Forgot Password?</a>
                </div>
            </form>
        </div>
    </div>

    <div class="modal-overlay" id="signupModal">
        <div class="modal">
            <h2 style="margin-bottom: 1.5rem">Sign Up</h2>
            <form id="signupForm">
                <input type="text" id="signupName" placeholder="Full Name" required>
                <input type="email" id="signupEmail" placeholder="Email" required>
                <input type="password" id="signupPassword" placeholder="Password" required>
                <button type="submit" class="btn btn-signup" style="width: 100%">Create Account</button>
                <p id="signupMsg" class="auth-msg"></p>
            </form>
        </div>
    </div>

    <div id="forgotPasswordModal" class="modal-overlay">
        <div class="absolute inset-0 bg-cyber-darker/90 backdrop-blur-md" onclick="toggleModal('forgotPasswordModal')"></div>
        <div class="bg-[#0A0B0D] border-2 border-white w-full max-w-md rounded-xl p-8 relative shadow-2xl">
            <h2 class="font-bold text-white mb-6 text-xl tracking-tighter lowercase">Reset Password</h2>
            
            <div class="mb-6 p-4 bg-black/50 border border-white/10 rounded-lg">
                <p class="text-gray-400 text-sm mb-2">
                    <strong>üìß How it works:</strong>
                </p>
                <ol class="text-gray-500 text-xs space-y-1 list-decimal list-inside">
                    <li>Enter your email address below</li>
                    <li>Check your inbox for reset link</li>
                    <li>Click the link to create new password</li>
                    <li>Link expires in 1 hour for security</li>
                </ol>
            </div>
            
            <form id="forgotPasswordForm">
                <div class="mb-4">
                    <label class="block text-[10px] font-mono text-gray-500 uppercase tracking-widest mb-2">Email Address</label>
                    <input type="email" id="resetEmail" placeholder="Enter your email address" class="w-full bg-black border border-white/10 rounded-lg p-4 text-white focus:outline-none focus:border-white font-mono text-sm" required>
                    <p class="text-gray-600 text-xs mt-1">We'll send a reset link to this address</p>
                </div>
                
                <button type="submit" class="w-full py-3 bg-cyber-blue text-white hover:bg-cyber-blue/80 transition-all text-[14px] lowercase tracking-tighter disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                    Send Reset Link
                </button>
                
                <p id="resetMsg" class="auth-msg text-center mt-4 text-sm"></p>
                
                <div class="mt-6 pt-4 border-t border-white/10 space-y-2">
                    <div style="text-align: center;">
                        <a href="#" onclick="toggleModal('loginModal'); toggleModal('forgotPasswordModal');" class="text-cyber-blue hover:text-cyber-blue/80 text-sm transition-colors">‚Üê Back to Login</a>
                    </div>
                    <div style="text-align: center;">
                        <a href="#" onclick="toggleModal('signupModal'); toggleModal('forgotPasswordModal');" class="text-gray-400 hover:text-white text-sm transition-colors">Don't have an account? Sign up</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, sendEmailVerification, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCiCPymL7UVi1PWRDQVyRYNn2z9HNjC1V0",
            authDomain: "cybershare-001.firebaseapp.com",
            projectId: "cybershare-001",
            storageBucket: "cybershare-001.firebasestorage.app",
            messagingSenderId: "300595987814",
            appId: "1:300595987814:web:f1a81e68926cba2553b4a7"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);

        const displayMsg = (elementId, message, isError = true) => {
            const el = document.getElementById(elementId);
            el.innerText = message;
            el.className = isError ? "auth-msg msg-error" : "auth-msg msg-success";
        };

        // Sign Up Logic
        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const name = document.getElementById('signupName').value;

            displayMsg("signupMsg", "Processing...", false);

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, password);
                await sendEmailVerification(userCredential.user);
                
                localStorage.setItem('username', name.toUpperCase());
                localStorage.setItem('isVerified', 'false');

                displayMsg("signupMsg", "Account created! Verify email to post.", false);
                setTimeout(() => { window.location.href = 'home.html'; }, 2000);
            } catch (error) {
                displayMsg("signupMsg", error.message);
            }
        });

        // Login Logic
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            displayMsg("loginMsg", "Authenticating...", false);

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                const user = userCredential.user;
                
                localStorage.setItem('username', email.split('@')[0].toUpperCase());
                localStorage.setItem('isVerified', user.emailVerified);

                if (!user.emailVerified) {
                    // Mark user as unverified
                    document.getElementById('loginModal').classList.add('unverified-user');
                    displayMsg("loginMsg", "‚ö†Ô∏è Unverified User. Please check your email and click the verification link.", true);
                    
                    // Add verification warning
                    const existingWarning = document.querySelector('.verification-warning');
                    if (!existingWarning) {
                        const warning = document.createElement('div');
                        warning.className = 'verification-warning';
                        warning.innerHTML = `
                            <strong>EMAIL VERIFICATION REQUIRED</strong><br>
                            Check your inbox for the verification email.<br>
                            <small>If not received, check spam folder or <a href="#" onclick="resendVerification()" style="color: white;">resend verification</a></small>
                        `;
                        document.getElementById('loginForm').appendChild(warning);
                    }
                    
                    // Add unverified badge to header
                    const authButtons = document.querySelector('.auth-buttons');
                    const existingBadge = document.querySelector('.unverified-badge');
                    if (!existingBadge) {
                        const badge = document.createElement('span');
                        badge.className = 'unverified-badge';
                        badge.textContent = 'UNVERIFIED';
                        badge.style.marginLeft = '10px';
                        authButtons.appendChild(badge);
                    }
                    
                    return; // Don't redirect if not verified
                }

                // Remove unverified styling if verified
                document.getElementById('loginModal').classList.remove('unverified-user');
                const warning = document.querySelector('.verification-warning');
                if (warning) warning.remove();
                const badge = document.querySelector('.unverified-badge');
                if (badge) badge.remove();

                displayMsg("loginMsg", "Access Granted. Redirecting...", false);
                setTimeout(() => { window.location.href = '/home.html'; }, 1000);
            } catch (error) {
                displayMsg("loginMsg", "Invalid credentials.");
            }
        });

        // Resend verification function
        window.resendVerification = async () => {
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, password);
                await sendEmailVerification(userCredential.user);
                displayMsg("loginMsg", "‚úÖ Verification email resent! Check your inbox.", false);
            } catch (error) {
                displayMsg("loginMsg", "Failed to resend verification email.", true);
            }
        };

        // Forgot password function - Enhanced for forgotten passwords
        document.getElementById('forgotPasswordForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('resetEmail').value.trim();

            // Enhanced email validation
            if (!email || !isValidEmail(email)) {
                displayMsg("resetMsg", 
                    "‚ùå Invalid email address<br><small>Please enter a valid email (e.g., user@example.com)</small>", 
                    true
                );
                return;
            }

            // Disable button and show loading state
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerText;
            submitBtn.disabled = true;
            submitBtn.innerText = "Sending...";
            submitBtn.classList.add('opacity-50', 'cursor-not-allowed');

            displayMsg("resetMsg", 
                "üìß Sending password reset link...<br><small>Please wait while we process your request</small>", 
                false
            );

            try {
                // Send password reset email via Firebase
                await sendPasswordResetEmail(auth, email);
                
                // Success message with comprehensive instructions
                displayMsg("resetMsg", 
                    "‚úÖ Password reset link sent successfully!<br><small>" +
                    "üì¨ Check your email inbox (and spam folder)<br>" +
                    "‚è∞ Link expires in 1 hour for security<br>" +
                    "üîó Click the link to create your new password</small>", 
                    false
                );
                
                // Store email for potential follow-up
                sessionStorage.setItem('resetEmail', email);
                
                // Clear form
                document.getElementById('resetEmail').value = '';
                
                // Update button to success state
                submitBtn.innerText = "‚úì Email Sent";
                submitBtn.classList.remove('opacity-50');
                submitBtn.classList.add('bg-green-600');
                
                // Auto-close modal after 5 seconds for better user experience
                setTimeout(() => {
                    toggleModal('forgotPasswordModal');
                    toggleModal('loginModal');
                    
                    // Reset button state
                    submitBtn.disabled = false;
                    submitBtn.innerText = originalText;
                    submitBtn.classList.remove('bg-green-600');
                    
                    // Clear session storage
                    sessionStorage.removeItem('resetEmail');
                }, 5000);
                
            } catch (error) {
                console.error("Password reset error:", error);
                
                let errorMessage = "Failed to send reset link.";
                let helpText = "";
                let troubleshooting = "";
                
                // Enhanced error handling
                if (error.code === 'auth/user-not-found') {
                    errorMessage = "‚ùå No account found with this email";
                    helpText = "<small>Double-check the email address or create a new account</small>";
                    troubleshooting = "<small>Make sure you're using the email you registered with</small>";
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = "‚ùå Invalid email address format";
                    helpText = "<small>Please enter a valid email address (e.g., user@example.com)</small>";
                    troubleshooting = "<small>Email should contain @ and a domain name</small>";
                } else if (error.code === 'auth/too-many-requests') {
                    errorMessage = "Too many reset attempts";
                    helpText = "<small>Please wait a few minutes before trying again</small>";
                    troubleshooting = "<small>For immediate help, contact support</small>";
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = "üåê Network connection error";
                    helpText = "<small>Check your internet connection and try again</small>";
                    troubleshooting = "<small>Try refreshing the page or switching networks</small>";
                } else {
                    errorMessage = "‚ö†Ô∏è An unexpected error occurred";
                    helpText = "<small>Please try again or contact support if the problem persists</small>";
                    troubleshooting = "<small> Error code: " + (error.code || 'UNKNOWN') + "</small>";
                }
                
                displayMsg("resetMsg", 
                    errorMessage + "<br>" + helpText + "<br>" + troubleshooting, 
                    true
                );
                
                // Reset button state
                submitBtn.disabled = false;
                submitBtn.innerText = originalText;
                submitBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }
        });

        // Email validation helper function
        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email) && email.length > 5 && email.length < 100;
        }

        // Add email validation on input
        document.getElementById('resetEmail').addEventListener('input', (e) => {
            const email = e.target.value.trim();
            const submitBtn = e.target.form.querySelector('button[type="submit"]');
            
            if (email && isValidEmail(email)) {
                submitBtn.disabled = false;
                submitBtn.classList.remove('opacity-50');
            } else {
                submitBtn.disabled = true;
                submitBtn.classList.add('opacity-50');
            }
        });

            </script>

    <script>
        function toggleModal(id) {
            const modal = document.getElementById(id);
            const msg = modal.querySelector('.auth-msg');
            if(msg) msg.innerText = "";
            modal.classList.toggle('modal-active');
        }
        
        // Open forgot password modal with pre-filled email
        window.openForgotPassword = () => {
            // Get email from login form
            const loginEmail = document.getElementById('loginEmail').value.trim();
            
            // Switch modals
            toggleModal('loginModal');
            toggleModal('forgotPasswordModal');
            
            // Pre-fill email if available
            if (loginEmail) {
                document.getElementById('resetEmail').value = loginEmail;
                
                // Trigger validation to enable button
                const event = new Event('input');
                document.getElementById('resetEmail').dispatchEvent(event);
            }
        };
        
        window.onclick = function(event) {
            if (event.target.className === 'modal-overlay modal-active') {
                event.target.classList.remove('modal-active');
            }
        }
    </script>

    <script>
        // Check for unverified user on page load
        window.addEventListener('load', () => {
            const isVerified = localStorage.getItem('isVerified');
            const username = localStorage.getItem('username');
            
            if (username && isVerified === 'false') {
                // Mark user as unverified in UI
                const authButtons = document.querySelector('.auth-buttons');
                const badge = document.createElement('span');
                badge.className = 'unverified-badge';
                badge.textContent = 'UNVERIFIED';
                badge.style.marginLeft = '10px';
                authButtons.appendChild(badge);
                
                // Add yellow styling to login modal
                document.getElementById('loginModal').classList.add('unverified-user');
            }
        });
    </script>
</body>
</html>